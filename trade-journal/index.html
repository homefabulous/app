
<!DOCTYPE html>
<html lang="en" class="dark">
<head><script>window.huggingface={variables:{"SPACE_CREATOR_USER_ID":"67b0cdf0c3a950e93e6592c8"}};</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TradeJournal Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                screens: {
                    'xs': '375px',
                    'sm': '640px',
                    'md': '768px',
                    'lg': '1024px',
                    'xl': '1280px',
                    '2xl': '1536px',
                },
                extend: {
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                        secondary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                        dark: {
                            800: '#1e293b',
                            900: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .dropzone {
            border: 2px dashed #64748b;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
        }
        .dropzone.active {
            border-color: #0ea5e9;
            background-color: rgba(14, 165, 233, 0.05);
        }
        .trade-card {
            transition: all 0.3s ease;
        }
        .trade-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .calendar-day {
            transition: all 0.2s ease;
        }
        .calendar-day:hover {
            background-color: rgba(14, 165, 233, 0.1);
        }
        .calendar-day.has-trades {
            background-color: rgba(14, 165, 233, 0.2);
        }
        .table-row {
            transition: all 0.2s ease;
        }
        .table-row:hover {
            background-color: rgba(14, 165, 233, 0.05);
        }
        /* Responsive adjustments */
        @media (max-width: 639px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            .filter-controls {
                flex-direction: column;
                gap: 0.5rem;
            }
            .view-controls {
                justify-content: flex-start;
            }
            .trade-form-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            .details-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .modal-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            .modal-buttons button {
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div class="container mx-auto px-3 sm:px-4 py-6">
        <!-- Header -->
        <header class="flex flex-col xs:flex-row justify-between items-start xs:items-center mb-6 gap-4">
            <div class="flex items-center space-x-2">
                <div class="bg-gradient-to-r from-primary-500 to-secondary-500 w-10 h-10 rounded-lg flex items-center justify-center">
                    <i class="fas fa-chart-line text-white"></i>
                </div>
                <h1 class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-primary-400 to-secondary-400 bg-clip-text text-transparent">TradeJournal Pro</h1>
            </div>
            <div class="flex items-center space-x-3 w-full xs:w-auto justify-between xs:justify-normal">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-800">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="add-trade-btn" class="bg-primary-600 hover:bg-primary-700 px-3 sm:px-4 py-2 rounded-lg flex items-center space-x-2 transition whitespace-nowrap">
                    <i class="fas fa-plus"></i>
                    <span class="hidden xs:inline">Add Trade</span>
                </button>
            </div>
        </header>

        <!-- Stats Overview -->
        <div class="grid stats-grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
            <div class="bg-gray-800 rounded-lg p-4 border-l-4 border-green-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-400 text-sm sm:text-base">Total Wins</p>
                        <h3 class="text-xl sm:text-2xl font-bold" id="wins-count">0</h3>
                    </div>
                    <div class="bg-green-500/20 p-2 sm:p-3 rounded-full">
                        <i class="fas fa-trophy text-green-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-gray-800 rounded-lg p-4 border-l-4 border-red-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-400 text-sm sm:text-base">Total Losses</p>
                        <h3 class="text-xl sm:text-2xl font-bold" id="losses-count">0</h3>
                    </div>
                    <div class="bg-red-500/20 p-2 sm:p-3 rounded-full">
                        <i class="fas fa-exclamation-triangle text-red-500"></i>
                    </div>
                </div>
            </div>
            <div class="bg-gray-800 rounded-lg p-4 border-l-4 border-primary-500">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-gray-400 text-sm sm:text-base">Total Trades</p>
                        <h3 class="text-xl sm:text-2xl font-bold" id="total-trades">0</h3>
                    </div>
                    <div class="bg-primary-500/20 p-2 sm:p-3 rounded-full">
                        <i class="fas fa-exchange-alt text-primary-500"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters and View Toggle -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-3">
            <div class="flex flex-wrap gap-2 filter-controls w-full">
                <button class="filter-btn px-3 py-1 sm:px-4 sm:py-2 rounded-lg bg-primary-600 text-white text-sm sm:text-base" data-filter="all">All</button>
                <button class="filter-btn px-3 py-1 sm:px-4 sm:py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-sm sm:text-base" data-filter="win">Wins</button>
                <button class="filter-btn px-3 py-1 sm:px-4 sm:py-2 rounded-lg bg-gray-800 hover:bg-gray-700 text-sm sm:text-base" data-filter="loss">Losses</button>
                <select id="date-filter" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-1 sm:px-4 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-500">
                    <option value="all">All Time</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="year">This Year</option>
                </select>
            </div>
            <div class="flex space-x-2 view-controls w-full md:w-auto justify-end">
                <button id="card-view-btn" class="view-toggle-btn p-2 rounded-lg bg-primary-600 text-white">
                    <i class="fas fa-th-large"></i>
                </button>
                <button id="table-view-btn" class="view-toggle-btn p-2 rounded-lg bg-gray-800 hover:bg-gray-700">
                    <i class="fas fa-table"></i>
                </button>
                <button id="calendar-view-btn" class="view-toggle-btn p-2 rounded-lg bg-gray-800 hover:bg-gray-700">
                    <i class="fas fa-calendar-alt"></i>
                </button>
            </div>
        </div>

        <!-- Trade Cards View -->
        <div id="cards-view" class="grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6">
            <!-- Trade cards will be dynamically inserted here -->
        </div>

        <!-- Table View (Hidden by default) -->
        <div id="table-view" class="hidden mb-6">
            <div class="overflow-x-auto rounded-lg border border-gray-700">
                <table class="min-w-full divide-y divide-gray-700">
                    <thead class="bg-gray-800">
                        <tr>
                            <th scope="col" class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Date</th>
                            <th scope="col" class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Symbol</th>
                            <th scope="col" class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Type</th>
                            <th scope="col" class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Result</th>
                            <th scope="col" class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Notes</th>
                            <th scope="col" class="px-3 py-2 sm:px-6 sm:py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="table-body" class="bg-gray-900 divide-y divide-gray-700">
                        <!-- Table rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Calendar View (Hidden by default) -->
        <div id="calendar-view" class="hidden mb-6">
            <div class="bg-gray-800 rounded-lg p-3 sm:p-4">
                <div class="flex justify-between items-center mb-3">
                    <button id="prev-month" class="p-1 sm:p-2 rounded-full hover:bg-gray-700">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h3 id="current-month" class="text-lg sm:text-xl font-bold">Month Year</h3>
                    <button id="next-month" class="p-1 sm:p-2 rounded-full hover:bg-gray-700">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="grid grid-cols-7 gap-1 text-xs sm:text-sm">
                    <div class="text-center text-gray-400 font-medium py-1 sm:py-2">Sun</div>
                    <div class="text-center text-gray-400 font-medium py-1 sm:py-2">Mon</div>
                    <div class="text-center text-gray-400 font-medium py-1 sm:py-2">Tue</div>
                    <div class="text-center text-gray-400 font-medium py-1 sm:py-2">Wed</div>
                    <div class="text-center text-gray-400 font-medium py-1 sm:py-2">Thu</div>
                    <div class="text-center text-gray-400 font-medium py-1 sm:py-2">Fri</div>
                    <div class="text-center text-gray-400 font-medium py-1 sm:py-2">Sat</div>
                </div>
                <div id="calendar-days" class="grid grid-cols-7 gap-1 text-xs sm:text-sm">
                    <!-- Calendar days will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- No Trades Message -->
        <div id="no-trades-message" class="text-center py-8 sm:py-12">
            <div class="mx-auto w-20 h-20 sm:w-24 sm:h-24 bg-gray-800 rounded-full flex items-center justify-center mb-3 sm:mb-4">
                <i class="fas fa-book-open text-gray-600 text-2xl sm:text-3xl"></i>
            </div>
            <h3 class="text-lg sm:text-xl font-bold mb-2">No trades yet</h3>
            <p class="text-gray-400 mb-3 sm:mb-4 text-sm sm:text-base">Start by adding your first trade to track your progress</p>
            <button id="add-first-trade-btn" class="bg-primary-600 hover:bg-primary-700 px-4 sm:px-6 py-2 rounded-lg transition text-sm sm:text-base">
                Add Your First Trade
            </button>
        </div>
    </div>

    <!-- Add/Edit Trade Modal -->
    <div id="trade-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-2 sm:px-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto mx-2">
            <div class="p-4 sm:p-6">
                <div class="flex justify-between items-center mb-3 sm:mb-4">
                    <h3 class="text-lg sm:text-xl font-bold" id="modal-title">Add New Trade</h3>
                    <button id="close-modal" class="p-1 sm:p-2 rounded-full hover:bg-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="trade-form" class="space-y-3 sm:space-y-4">
                    <input type="hidden" id="trade-id">
                    <div class="grid trade-form-grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label for="symbol" class="block text-sm font-medium text-gray-300 mb-1">Symbol</label>
                            <input type="text" id="symbol" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-500" required>
                        </div>
                        <div>
                            <label for="trade-type" class="block text-sm font-medium text-gray-300 mb-1">Trade Type</label>
                            <select id="trade-type" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-500" required>
                                <option value="long">Long</option>
                                <option value="short">Short</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid trade-form-grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label for="entry-price" class="block text-sm font-medium text-gray-300 mb-1">Entry Price</label>
                            <input type="number" step="0.0001" id="entry-price" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-500" required>
                        </div>
                        <div>
                            <label for="exit-price" class="block text-sm font-medium text-gray-300 mb-1">Exit Price</label>
                            <input type="number" step="0.0001" id="exit-price" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-500" required>
                        </div>
                    </div>
                    <div class="grid trade-form-grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label for="entry-date" class="block text-sm font-medium text-gray-300 mb-1">Entry Date</label>
                            <input type="datetime-local" id="entry-date" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-500" required>
                        </div>
                        <div>
                            <label for="exit-date" class="block text-sm font-medium text-gray-300 mb-1">Exit Date</label>
                            <input type="datetime-local" id="exit-date" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-500" required>
                        </div>
                    </div>
                    <div>
                        <label for="notes" class="block text-sm font-medium text-gray-300 mb-1">Notes</label>
                        <textarea id="notes" rows="3" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-primary-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">Trade Result</label>
                        <div class="flex space-x-3 sm:space-x-4">
                            <label class="inline-flex items-center">
                                <input type="radio" name="result" value="win" class="form-radio text-green-500 bg-gray-700 border-gray-600" checked>
                                <span class="ml-2 text-sm sm:text-base">Win</span>
                            </label>
                            <label class="inline-flex items-center">
                                <input type="radio" name="result" value="loss" class="form-radio text-red-500 bg-gray-700 border-gray-600">
                                <span class="ml-2 text-sm sm:text-base">Loss</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-1">Screenshot/Chart</label>
                        <div id="dropzone" class="dropzone p-4 sm:p-8 text-center cursor-pointer">
                            <div id="dropzone-content">
                                <i class="fas fa-cloud-upload-alt text-2xl sm:text-3xl text-gray-400 mb-1 sm:mb-2"></i>
                                <p class="text-gray-400 text-xs sm:text-sm">Drag & drop your image here or click to browse</p>
                                <p class="text-xs text-gray-500 mt-1">Supports JPG, PNG (Max 5MB)</p>
                            </div>
                            <input type="file" id="image-upload" accept="image/*" class="hidden">
                            <div id="image-preview" class="hidden mt-3 sm:mt-4">
                                <img id="preview-image" src="" class="max-h-40 sm:max-h-48 mx-auto rounded-lg">
                                <button id="remove-image" class="mt-1 sm:mt-2 text-red-500 hover:text-red-400 text-xs sm:text-sm">
                                    <i class="fas fa-trash mr-1"></i> Remove Image
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-3 pt-3 sm:pt-4 modal-buttons">
                        <button type="button" id="cancel-trade" class="px-3 sm:px-4 py-1 sm:py-2 rounded-lg border border-gray-600 hover:bg-gray-700 transition text-sm sm:text-base">
                            Cancel
                        </button>
                        <button type="submit" id="save-trade" class="px-4 sm:px-6 py-1 sm:py-2 rounded-lg bg-primary-600 hover:bg-primary-700 transition text-sm sm:text-base">
                            Save Trade
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Trade Details Modal -->
    <div id="details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden px-2 sm:px-4">
        <div class="bg-gray-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto mx-2">
            <div class="p-4 sm:p-6">
                <div class="flex justify-between items-center mb-3 sm:mb-4">
                    <h3 class="text-lg sm:text-xl font-bold">Trade Details</h3>
                    <button id="close-details-modal" class="p-1 sm:p-2 rounded-full hover:bg-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="grid details-grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
                    <div>
                        <div class="mb-3 sm:mb-4">
                            <h4 class="text-md sm:text-lg font-semibold mb-1 sm:mb-2" id="details-symbol">AAPL</h4>
                            <div class="flex items-center space-x-2 mb-1 sm:mb-2">
                                <span id="details-type" class="px-2 py-1 rounded text-xs font-medium bg-blue-500/20 text-blue-400">Long</span>
                                <span id="details-result" class="px-2 py-1 rounded text-xs font-medium bg-green-500/20 text-green-400">Win</span>
                            </div>
                            <div class="space-y-2 text-xs sm:text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Entry Price:</span>
                                    <span id="details-entry-price" class="font-medium">$145.32</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Exit Price:</span>
                                    <span id="details-exit-price" class="font-medium">$152.67</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Profit/Loss:</span>
                                    <span id="details-pnl" class="font-medium">+$7.35 (5.06%)</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Entry Date:</span>
                                    <span id="details-entry-date" class="font-medium">May 15, 2023 10:30 AM</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Exit Date:</span>
                                    <span id="details-exit-date" class="font-medium">May 18, 2023 2:45 PM</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h5 class="text-sm sm:text-md font-semibold mb-1 sm:mb-2 text-gray-300">Notes</h5>
                            <p id="details-notes" class="text-gray-300 bg-gray-700 rounded-lg p-2 sm:p-3 text-xs sm:text-sm">Bought on breakout of resistance level with high volume. Sold when RSI reached overbought territory.</p>
                        </div>
                    </div>
                    <div>
                        <div class="bg-gray-700 rounded-lg overflow-hidden">
                            <img id="details-image" src="" alt="Trade chart" class="w-full h-auto">
                        </div>
                        <div class="flex flex-col xs:flex-row justify-end space-y-2 xs:space-y-0 xs:space-x-3 mt-3 sm:mt-4 modal-buttons">
                            <button id="edit-trade-btn" class="px-3 sm:px-4 py-1 sm:py-2 rounded-lg bg-primary-600 hover:bg-primary-700 transition text-sm sm:text-base">
                                <i class="fas fa-edit mr-1 sm:mr-2"></i> Edit
                            </button>
                            <button id="delete-trade-btn" class="px-3 sm:px-4 py-1 sm:py-2 rounded-lg bg-red-600 hover:bg-red-700 transition text-sm sm:text-base">
                                <i class="fas fa-trash mr-1 sm:mr-2"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const themeToggle = document.getElementById('theme-toggle');
        const addTradeBtn = document.getElementById('add-trade-btn');
        const addFirstTradeBtn = document.getElementById('add-first-trade-btn');
        const tradeModal = document.getElementById('trade-modal');
        const closeModal = document.getElementById('close-modal');
        const cancelTrade = document.getElementById('cancel-trade');
        const tradeForm = document.getElementById('trade-form');
        const saveTradeBtn = document.getElementById('save-trade');
        const cardsView = document.getElementById('cards-view');
        const tableView = document.getElementById('table-view');
        const calendarView = document.getElementById('calendar-view');
        const cardViewBtn = document.getElementById('card-view-btn');
        const tableViewBtn = document.getElementById('table-view-btn');
        const calendarViewBtn = document.getElementById('calendar-view-btn');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const dateFilter = document.getElementById('date-filter');
        const noTradesMessage = document.getElementById('no-trades-message');
        const tableBody = document.getElementById('table-body');
        const currentMonthEl = document.getElementById('current-month');
        const calendarDaysEl = document.getElementById('calendar-days');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const detailsModal = document.getElementById('details-modal');
        const closeDetailsModal = document.getElementById('close-details-modal');
        const editTradeBtn = document.getElementById('edit-trade-btn');
        const deleteTradeBtn = document.getElementById('delete-trade-btn');
        const dropzone = document.getElementById('dropzone');
        const imageUpload = document.getElementById('image-upload');
        const imagePreview = document.getElementById('image-preview');
        const previewImage = document.getElementById('preview-image');
        const removeImage = document.getElementById('remove-image');
        const winsCount = document.getElementById('wins-count');
        const lossesCount = document.getElementById('losses-count');
        const totalTrades = document.getElementById('total-trades');

        // State
        let trades = JSON.parse(localStorage.getItem('trades')) || [];
        let currentView = 'cards';
        let currentFilter = 'all';
        let currentDateFilter = 'all';
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let currentTradeId = null;
        let currentImageFile = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateStats();
            renderTrades();
            renderCalendar();
            checkEmptyState();
            
            // Set current month display
            updateMonthDisplay();
        });

        // Theme Toggle
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            if (document.documentElement.classList.contains('dark')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        });

        // Modal Controls
        addTradeBtn.addEventListener('click', () => openTradeModal());
        addFirstTradeBtn.addEventListener('click', () => openTradeModal());
        closeModal.addEventListener('click', () => closeTradeModal());
        cancelTrade.addEventListener('click', () => closeTradeModal());
        closeDetailsModal.addEventListener('click', () => detailsModal.classList.add('hidden'));

        // View Toggle
        cardViewBtn.addEventListener('click', () => switchView('cards'));
        tableViewBtn.addEventListener('click', () => switchView('table'));
        calendarViewBtn.addEventListener('click', () => switchView('calendar'));

        // Filter Controls
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('bg-primary-600', 'text-white'));
                btn.classList.add('bg-primary-600', 'text-white');
                currentFilter = btn.dataset.filter;
                renderTrades();
            });
        });

        dateFilter.addEventListener('change', () => {
            currentDateFilter = dateFilter.value;
            renderTrades();
        });

        // Calendar Navigation
        prevMonthBtn.addEventListener('click', () => {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            updateMonthDisplay();
            renderCalendar();
        });

        nextMonthBtn.addEventListener('click', () => {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            updateMonthDisplay();
            renderCalendar();
        });

        // Image Upload Handling
        dropzone.addEventListener('click', () => imageUpload.click());
        
        imageUpload.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleImageUpload(e.target.files[0]);
            }
        });

        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('active');
        });

        dropzone.addEventListener('dragleave', () => {
            dropzone.classList.remove('active');
        });

        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('active');
            if (e.dataTransfer.files.length) {
                handleImageUpload(e.dataTransfer.files[0]);
            }
        });

        removeImage.addEventListener('click', (e) => {
            e.stopPropagation();
            currentImageFile = null;
            imagePreview.classList.add('hidden');
            document.getElementById('dropzone-content').classList.remove('hidden');
        });

        // Form Submission
        tradeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            saveTrade();
        });

        // Edit/Delete Trade
        editTradeBtn.addEventListener('click', () => {
            detailsModal.classList.add('hidden');
            openTradeModal(currentTradeId);
        });

        deleteTradeBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to delete this trade?')) {
                trades = trades.filter(trade => trade.id !== currentTradeId);
                saveTrades();
                detailsModal.classList.add('hidden');
                renderTrades();
                checkEmptyState();
            }
        });

        // Functions
        function openTradeModal(tradeId = null) {
            tradeModal.classList.remove('hidden');
            document.getElementById('modal-title').textContent = tradeId ? 'Edit Trade' : 'Add New Trade';
            
            if (tradeId) {
                const trade = trades.find(t => t.id === tradeId);
                if (trade) {
                    document.getElementById('trade-id').value = trade.id;
                    document.getElementById('symbol').value = trade.symbol;
                    document.getElementById('trade-type').value = trade.type;
                    document.getElementById('entry-price').value = trade.entryPrice;
                    document.getElementById('exit-price').value = trade.exitPrice;
                    document.getElementById('entry-date').value = formatDateTimeForInput(trade.entryDate);
                    document.getElementById('exit-date').value = formatDateTimeForInput(trade.exitDate);
                    document.getElementById('notes').value = trade.notes;
                    document.querySelector(`input[name="result"][value="${trade.result}"]`).checked = true;
                    
                    if (trade.image) {
                        currentImageFile = trade.image;
                        previewImage.src = trade.image;
                        imagePreview.classList.remove('hidden');
                        document.getElementById('dropzone-content').classList.add('hidden');
                    } else {
                        currentImageFile = null;
                        imagePreview.classList.add('hidden');
                        document.getElementById('dropzone-content').classList.remove('hidden');
                    }
                }
            } else {
                tradeForm.reset();
                currentImageFile = null;
                imagePreview.classList.add('hidden');
                document.getElementById('dropzone-content').classList.remove('hidden');
                
                // Set default dates to now
                const now = new Date();
                const nowStr = formatDateTimeForInput(now);
                document.getElementById('entry-date').value = nowStr;
                document.getElementById('exit-date').value = nowStr;
            }
        }

        function closeTradeModal() {
            tradeModal.classList.add('hidden');
        }

        function handleImageUpload(file) {
            if (!file.type.match('image.*')) {
                alert('Please select an image file (JPG, PNG)');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('Image size should be less than 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                currentImageFile = e.target.result;
                previewImage.src = currentImageFile;
                imagePreview.classList.remove('hidden');
                document.getElementById('dropzone-content').classList.add('hidden');
            };
            reader.readAsDataURL(file);
        }

        function saveTrade() {
            const id = document.getElementById('trade-id').value || generateId();
            const symbol = document.getElementById('symbol').value;
            const type = document.getElementById('trade-type').value;
            const entryPrice = parseFloat(document.getElementById('entry-price').value);
            const exitPrice = parseFloat(document.getElementById('exit-price').value);
            const entryDate = new Date(document.getElementById('entry-date').value);
            const exitDate = new Date(document.getElementById('exit-date').value);
            const notes = document.getElementById('notes').value;
            const result = document.querySelector('input[name="result"]:checked').value;
            
            const pnl = exitPrice - entryPrice;
            const pnlPercent = (pnl / entryPrice) * 100;
            
            const trade = {
                id,
                symbol,
                type,
                entryPrice,
                exitPrice,
                entryDate: entryDate.toISOString(),
                exitDate: exitDate.toISOString(),
                notes,
                result,
                pnl,
                pnlPercent,
                image: currentImageFile
            };
            
            const existingIndex = trades.findIndex(t => t.id === id);
            if (existingIndex >= 0) {
                trades[existingIndex] = trade;
            } else {
                trades.push(trade);
            }
            
            saveTrades();
            closeTradeModal();
            renderTrades();
            checkEmptyState();
        }

        function saveTrades() {
            localStorage.setItem('trades', JSON.stringify(trades));
            updateStats();
        }

        function renderTrades() {
            // Filter trades
            let filteredTrades = [...trades];
            
            if (currentFilter !== 'all') {
                filteredTrades = filteredTrades.filter(trade => trade.result === currentFilter);
            }
            
            if (currentDateFilter !== 'all') {
                const now = new Date();
                let startDate;
                
                switch (currentDateFilter) {
                    case 'week':
                        startDate = new Date(now.setDate(now.getDate() - 7));
                        break;
                    case 'month':
                        startDate = new Date(now.setMonth(now.getMonth() - 1));
                        break;
                    case 'year':
                        startDate = new Date(now.setFullYear(now.getFullYear() - 1));
                        break;
                }
                
                filteredTrades = filteredTrades.filter(trade => {
                    const tradeDate = new Date(trade.exitDate);
                    return tradeDate >= startDate;
                });
            }
            
            // Sort by exit date (newest first)
            filteredTrades.sort((a, b) => new Date(b.exitDate) - new Date(a.exitDate));
            
            // Render based on current view
            if (currentView === 'cards') {
                renderCards(filteredTrades);
            } else if (currentView === 'table') {
                renderTable(filteredTrades);
            }
        }

        function renderCards(trades) {
            cardsView.innerHTML = '';
            
            if (trades.length === 0) {
                return;
            }
            
            trades.forEach(trade => {
                const card = document.createElement('div');
                card.className = 'trade-card bg-gray-800 rounded-xl overflow-hidden fade-in';
                card.innerHTML = `
                    <div class="relative h-32 xs:h-36 sm:h-40 bg-gray-700 overflow-hidden">
                        ${trade.image ? 
                            `<img src="${trade.image}" alt="Trade chart" class="w-full h-full object-cover">` : 
                            `<div class="w-full h-full flex items-center justify-center text-gray-500">
                                <i class="fas fa-chart-line text-3xl xs:text-4xl"></i>
                            </div>`
                        }
                        <div class="absolute top-2 right-2 flex space-x-1">
                            <span class="px-2 py-1 rounded text-[10px] xs:text-xs font-medium ${trade.type === 'long' ? 'bg-blue-500/20 text-blue-400' : 'bg-purple-500/20 text-purple-400'}">
                                ${trade.type.charAt(0).toUpperCase() + trade.type.slice(1)}
                            </span>
                            <span class="px-2 py-1 rounded text-[10px] xs:text-xs font-medium ${trade.result === 'win' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                                ${trade.result.charAt(0).toUpperCase() + trade.result.slice(1)}
                            </span>
                        </div>
                    </div>
                    <div class="p-3 xs:p-4">
                        <div class="flex justify-between items-start mb-1 xs:mb-2">
                            <h4 class="font-semibold text-sm xs:text-base">${trade.symbol}</h4>
                            <span class="text-xs xs:text-sm font-medium ${trade.pnl >= 0 ? 'text-green-400' : 'text-red-400'}">
                                ${trade.pnl >= 0 ? '+' : ''}${trade.pnl.toFixed(2)} (${trade.pnlPercent.toFixed(2)}%)
                            </span>
                        </div>
                        <p class="text-gray-400 text-xs xs:text-sm line-clamp-2">${trade.notes || 'No notes'}</p>
                        <button class="mt-2 xs:mt-3 text-primary-500 hover:text-primary-400 text-xs xs:text-sm font-medium trade-details-btn" data-id="${trade.id}">
                            View Details
                        </button>
                    </div>
                `;
                cardsView.appendChild(card);
            });
            
            // Add event listeners to details buttons
            document.querySelectorAll('.trade-details-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tradeId = btn.dataset.id;
                    showTradeDetails(tradeId);
                });
            });
        }

        function renderTable(trades) {
            tableBody.innerHTML = '';
            
            if (trades.length === 0) {
                return;
            }
            
            trades.forEach(trade => {
                const row = document.createElement('tr');
                row.className = 'table-row fade-in';
                row.innerHTML = `
                    <td class="px-3 py-2 sm:px-6 sm:py-3 whitespace-nowrap text-xs sm:text-sm">
                        ${formatDate(new Date(trade.exitDate))}
                    </td>
                    <td class="px-3 py-2 sm:px-6 sm:py-3 whitespace-nowrap text-xs sm:text-sm font-medium">
                        ${trade.symbol}
                    </td>
                    <td class="px-3 py-2 sm:px-6 sm:py-3 whitespace-nowrap text-xs sm:text-sm">
                        <span class="px-2 py-1 rounded text-[10px] xs:text-xs font-medium ${trade.type === 'long' ? 'bg-blue-500/20 text-blue-400' : 'bg-purple-500/20 text-purple-400'}">
                            ${trade.type.charAt(0).toUpperCase() + trade.type.slice(1)}
                        </span>
                    </td>
                    <td class="px-3 py-2 sm:px-6 sm:py-3 whitespace-nowrap text-xs sm:text-sm">
                        <span class="px-2 py-1 rounded text-[10px] xs:text-xs font-medium ${trade.result === 'win' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}">
                            ${trade.result.charAt(0).toUpperCase() + trade.result.slice(1)}
                        </span>
                    </td>
                    <td class="px-3 py-2 sm:px-6 sm:py-3 text-xs sm:text-sm max-w-[200px] truncate">
                        ${trade.notes || '-'}
                    </td>
                    <td class="px-3 py-2 sm:px-6 sm:py-3 whitespace-nowrap text-right text-xs sm:text-sm font-medium">
                        <button class="text-primary-500 hover:text-primary-400 mr-2 table-details-btn" data-id="${trade.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="text-blue-500 hover:text-blue-400 mr-2 table-edit-btn" data-id="${trade.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-500 hover:text-red-400 table-delete-btn" data-id="${trade.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.table-details-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tradeId = btn.dataset.id;
                    showTradeDetails(tradeId);
                });
            });
            
            document.querySelectorAll('.table-edit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tradeId = btn.dataset.id;
                    openTradeModal(tradeId);
                });
            });
            
            document.querySelectorAll('.table-delete-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tradeId = btn.dataset.id;
                    if (confirm('Are you sure you want to delete this trade?')) {
                        trades = trades.filter(trade => trade.id !== tradeId);
                        saveTrades();
                        renderTrades();
                        checkEmptyState();
                    }
                });
            });
        }

        function renderCalendar() {
            calendarDaysEl.innerHTML = '';
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const lastMonthDays = new Date(currentYear, currentMonth, 0).getDate();
            
            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = document.createElement('div');
                day.className = 'calendar-day text-center py-1 sm:py-2 text-gray-600';
                day.textContent = lastMonthDays - i;
                calendarDaysEl.appendChild(day);
            }
            
            // Current month days
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                const date = new Date(currentYear, currentMonth, i);
                const hasTrades = trades.some(trade => {
                    const tradeDate = new Date(trade.exitDate);
                    return tradeDate.getFullYear() === date.getFullYear() && 
                           tradeDate.getMonth() === date.getMonth() && 
                           tradeDate.getDate() === date.getDate();
                });
                
                day.className = `calendar-day text-center py-1 sm:py-2 cursor-pointer rounded-md ${hasTrades ? 'has-trades' : ''}`;
                day.textContent = i;
                
                if (hasTrades) {
                    day.addEventListener('click', () => {
                        filterTradesByDate(date);
                    });
                }
                
                calendarDaysEl.appendChild(day);
            }
            
            // Next month days
            const totalCells = 42; // 6 rows x 7 days
            const remainingCells = totalCells - (firstDay + daysInMonth);
            for (let i = 1; i <= remainingCells; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day text-center py-1 sm:py-2 text-gray-600';
                day.textContent = i;
                calendarDaysEl.appendChild(day);
            }
        }

        function filterTradesByDate(date) {
            currentDateFilter = 'all';
            dateFilter.value = 'all';
            currentFilter = 'all';
            
            filterBtns.forEach(btn => {
                btn.classList.remove('bg-primary-600', 'text-white');
                if (btn.dataset.filter === 'all') {
                    btn.classList.add('bg-primary-600', 'text-white');
                }
            });
            
            let filteredTrades = trades.filter(trade => {
                const tradeDate = new Date(trade.exitDate);
                return tradeDate.getFullYear() === date.getFullYear() && 
                       tradeDate.getMonth() === date.getMonth() && 
                       tradeDate.getDate() === date.getDate();
            });
            
            if (currentView === 'cards') {
                renderCards(filteredTrades);
            } else if (currentView === 'table') {
                renderTable(filteredTrades);
            }
        }

        function showTradeDetails(tradeId) {
            const trade = trades.find(t => t.id === tradeId);
            if (!trade) return;
            
            currentTradeId = tradeId;
            
            document.getElementById('details-symbol').textContent = trade.symbol;
            document.getElementById('details-type').textContent = trade.type.charAt(0).toUpperCase() + trade.type.slice(1);
            document.getElementById('details-result').textContent = trade.result.charAt(0).toUpperCase() + trade.result.slice(1);
            document.getElementById('details-entry-price').textContent = `$${trade.entryPrice.toFixed(2)}`;
            document.getElementById('details-exit-price').textContent = `$${trade.exitPrice.toFixed(2)}`;
            
            const pnlSign = trade.pnl >= 0 ? '+' : '';
            document.getElementById('details-pnl').textContent = `${pnlSign}$${trade.pnl.toFixed(2)} (${trade.pnlPercent.toFixed(2)}%)`;
            document.getElementById('details-pnl').className = `font-medium ${trade.pnl >= 0 ? 'text-green-400' : 'text-red-400'}`;
            document.getElementById('details-result').className = `px-2 py-1 rounded text-xs font-medium ${trade.result === 'win' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`;
            
            document.getElementById('details-entry-date').textContent = formatDateTime(new Date(trade.entryDate));
            document.getElementById('details-exit-date').textContent = formatDateTime(new Date(trade.exitDate));
            document.getElementById('details-notes').textContent = trade.notes || 'No notes';
            
            if (trade.image) {
                document.getElementById('details-image').src = trade.image;
                document.getElementById('details-image').style.display = 'block';
            } else {
                document.getElementById('details-image').style.display = 'none';
            }
            
            detailsModal.classList.remove('hidden');
        }

        function switchView(view) {
            currentView = view;
            
            cardsView.classList.add('hidden');
            tableView.classList.add('hidden');
            calendarView.classList.add('hidden');
            
            cardViewBtn.classList.remove('bg-primary-600', 'text-white');
            tableViewBtn.classList.remove('bg-primary-600', 'text-white');
            calendarViewBtn.classList.remove('bg-primary-600', 'text-white');
            
            if (view === 'cards') {
                cardsView.classList.remove('hidden');
                cardViewBtn.classList.add('bg-primary-600', 'text-white');
                renderTrades();
            } else if (view === 'table') {
                tableView.classList.remove('hidden');
                tableViewBtn.classList.add('bg-primary-600', 'text-white');
                renderTrades();
            } else if (view === 'calendar') {
                calendarView.classList.remove('hidden');
                calendarViewBtn.classList.add('bg-primary-600', 'text-white');
            }
            
            checkEmptyState();
        }

        function checkEmptyState() {
            if (trades.length === 0) {
                noTradesMessage.classList.remove('hidden');
                cardsView.classList.add('hidden');
                tableView.classList.add('hidden');
                calendarView.classList.add('hidden');
            } else {
                noTradesMessage.classList.add('hidden');
                
                if (currentView === 'cards') {
                    cardsView.classList.remove('hidden');
                } else if (currentView === 'table') {
                    tableView.classList.remove('hidden');
                } else if (currentView === 'calendar') {
                    calendarView.classList.remove('hidden');
                }
            }
        }

        function updateStats() {
            const wins = trades.filter(trade => trade.result === 'win').length;
            const losses = trades.filter(trade => trade.result === 'loss').length;
            
            winsCount.textContent = wins;
            lossesCount.textContent = losses;
            totalTrades.textContent = trades.length;
        }

        function updateMonthDisplay() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            currentMonthEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(date) {
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function formatDateTime(date) {
            return date.toLocaleString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
        }

        function formatDateTimeForInput(date) {
            const isoString = new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString();
            return isoString.substring(0, 16);
        }
    </script>
</body>
</html>
