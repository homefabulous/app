
<!DOCTYPE html>
<html lang="en">
<head><script>window.huggingface={variables:{"SPACE_CREATOR_USER_ID":"66273db688596f571af5972c"}};</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grammar Quest - English Learning Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .pulse-animation {
            animation: pulse 1.5s infinite;
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        .option-card {
            transition: all 0.3s ease;
        }
        .option-card:hover {
            transform: translateY(-3px);
        }
        .correct-answer {
            background-color: #4ade80 !important;
            color: white !important;
        }
        .wrong-answer {
            background-color: #f87171 !important;
            color: white !important;
        }
        .floating-emoji {
            position: absolute;
            animation: float-up 2s forwards;
            opacity: 0;
        }
        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen font-sans">
    <!-- Music Control -->
    <div class="music-control">
        <button id="music-toggle" class="w-12 h-12 rounded-full bg-indigo-600 text-white flex items-center justify-center shadow-lg hover:bg-indigo-700 transition">
            <i class="fas fa-music"></i>
        </button>
        <audio id="background-music" loop>
            <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        </audio>
        <audio id="correct-sound">
            <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">
        </audio>
        <audio id="wrong-sound">
            <source src="https://www.soundjay.com/buttons/sounds/button-10.mp3" type="audio/mpeg">
        </audio>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-indigo-800 mb-2">Grammar Quest</h1>
            <p class="text-lg text-indigo-600">Master English grammar through fun challenges!</p>
            <div class="w-full bg-gray-200 rounded-full h-4 mt-6">
                <div id="progress-bar" class="progress-bar bg-indigo-600 h-4 rounded-full" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-2 text-sm text-indigo-800">
                <span>Progress: <span id="progress-text">0</span>%</span>
                <span>Score: <span id="score">0</span></span>
            </div>
        </header>

        <!-- Game Area -->
        <main class="max-w-3xl mx-auto">
            <!-- Start Screen -->
            <div id="start-screen" class="bg-white rounded-xl shadow-lg p-8 text-center">
                <div class="mb-8">
                    <i class="fas fa-book-open text-6xl text-indigo-500 mb-4"></i>
                    <h2 class="text-3xl font-bold text-gray-800 mb-4">Ready for the Challenge?</h2>
                    <p class="text-gray-600 mb-6">Test your grammar knowledge across different categories and difficulty levels.</p>
                </div>
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Select Difficulty:</h3>
                    <div class="flex flex-wrap justify-center gap-4 mb-6">
                        <button class="difficulty-btn px-6 py-2 rounded-full bg-green-100 text-green-800 hover:bg-green-200 transition" data-level="easy">Easy</button>
                        <button class="difficulty-btn px-6 py-2 rounded-full bg-yellow-100 text-yellow-800 hover:bg-yellow-200 transition" data-level="medium">Medium</button>
                        <button class="difficulty-btn px-6 py-2 rounded-full bg-red-100 text-red-800 hover:bg-red-200 transition" data-level="hard">Hard</button>
                    </div>
                </div>
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Select Category:</h3>
                    <div class="flex flex-wrap justify-center gap-4">
                        <button class="category-btn px-6 py-2 rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition" data-category="tenses">Tenses</button>
                        <button class="category-btn px-6 py-2 rounded-full bg-purple-100 text-purple-800 hover:bg-purple-200 transition" data-category="prepositions">Prepositions</button>
                        <button class="category-btn px-6 py-2 rounded-full bg-pink-100 text-pink-800 hover:bg-pink-200 transition" data-category="articles">Articles</button>
                        <button class="category-btn px-6 py-2 rounded-full bg-indigo-100 text-indigo-800 hover:bg-indigo-200 transition" data-category="conjunctions">Conjunctions</button>
                        <button class="category-btn px-6 py-2 rounded-full bg-green-100 text-green-800 hover:bg-green-200 transition" data-category="modals">Modals</button>
                        <button class="category-btn px-6 py-2 rounded-full bg-yellow-100 text-yellow-800 hover:bg-yellow-200 transition" data-category="conditionals">Conditionals</button>
                        <button class="category-btn px-6 py-2 rounded-full bg-red-100 text-red-800 hover:bg-red-200 transition" data-category="all">All Mixed</button>
                    </div>
                </div>
                <button id="start-btn" class="px-8 py-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition shadow-lg pulse-animation">
                    Start Game <i class="fas fa-play ml-2"></i>
                </button>
            </div>

            <!-- Question Screen -->
            <div id="question-screen" class="hidden bg-white rounded-xl shadow-lg p-8">
                <div class="flex justify-between items-center mb-6">
                    <span id="category-tag" class="px-3 py-1 rounded-full text-xs font-semibold"></span>
                    <span id="difficulty-tag" class="px-3 py-1 rounded-full text-xs font-semibold"></span>
                </div>
                <h2 id="question" class="text-2xl font-semibold text-gray-800 mb-8"></h2>
                <div id="options-container" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"></div>
                <div class="flex justify-between items-center">
                    <span id="question-count" class="text-sm text-gray-500"></span>
                    <button id="next-btn" class="px-6 py-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition hidden">
                        Next <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="hidden bg-white rounded-xl shadow-lg p-8 text-center">
                <div class="mb-8">
                    <i id="result-icon" class="fas text-6xl mb-4"></i>
                    <h2 id="result-title" class="text-3xl font-bold text-gray-800 mb-2"></h2>
                    <p id="result-subtitle" class="text-gray-600 mb-6"></p>
                </div>
                <div id="result-stats" class="bg-indigo-50 rounded-xl p-6 mb-8">
                    <div class="flex justify-around mb-6">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-indigo-700" id="final-score">0</div>
                            <div class="text-sm text-indigo-600">Score</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-indigo-700" id="correct-answers">0</div>
                            <div class="text-sm text-indigo-600">Correct</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-indigo-700" id="wrong-answers">0</div>
                            <div class="text-sm text-indigo-600">Wrong</div>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div id="final-progress" class="progress-bar bg-indigo-600 h-4 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Performance Breakdown</h3>
                    <div id="category-stats" class="grid grid-cols-2 gap-4 text-left"></div>
                </div>
                <div class="flex justify-center gap-4">
                    <button id="restart-btn" class="px-6 py-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition">
                        Play Again <i class="fas fa-redo ml-2"></i>
                    </button>
                    <button id="new-category-btn" class="px-6 py-2 bg-white border border-indigo-600 text-indigo-600 rounded-full hover:bg-indigo-50 transition">
                        New Category <i class="fas fa-random ml-2"></i>
                    </button>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="mt-16 text-center text-sm text-gray-500">
            <p>Grammar Quest &copy; 2023 | Learn English the fun way!</p>
        </footer>
    </div>

    <script>
        // Game Data
        const questions = {
            tenses: [
                {
                    question: "She _____ to the store every morning.",
                    options: ["go", "goes", "going", "gone"],
                    answer: 1,
                    explanation: "The correct answer is 'goes' because it's the present simple tense for third person singular."
                },
                {
                    question: "By next year, I _____ here for five years.",
                    options: ["will work", "will have worked", "have worked", "worked"],
                    answer: 1,
                    explanation: "The correct answer is 'will have worked' because it's the future perfect tense."
                },
                {
                    question: "They _____ dinner when the phone rang.",
                    options: ["had", "were having", "have had", "had had"],
                    answer: 1,
                    explanation: "The correct answer is 'were having' because it's the past continuous tense for an interrupted action."
                },
                {
                    question: "If I _____ you, I would apologize.",
                    options: ["am", "was", "were", "had been"],
                    answer: 2,
                    explanation: "The correct answer is 'were' because it's the subjunctive mood in a conditional sentence."
                },
                {
                    question: "She _____ her homework before going out to play.",
                    options: ["finished", "had finished", "has finished", "was finishing"],
                    answer: 1,
                    explanation: "The correct answer is 'had finished' because it's the past perfect tense showing an action completed before another past action."
                },
                {
                    question: "I _____ my keys. Can you help me look for them?",
                    options: ["lose", "lost", "have lost", "had lost"],
                    answer: 2,
                    explanation: "The correct answer is 'have lost' because it's the present perfect for a recent past action with present relevance."
                },
                {
                    question: "The sun _____ in the east and _____ in the west.",
                    options: ["rises / sets", "is rising / is setting", "rose / set", "has risen / has set"],
                    answer: 0,
                    explanation: "The correct answer is 'rises / sets' because it's a general truth using present simple."
                },
                {
                    question: "By the time we arrived, the movie _____.",
                    options: ["already started", "had already started", "has already started", "was already starting"],
                    answer: 1,
                    explanation: "The correct answer is 'had already started' because it's the past perfect for an action completed before another past action."
                },
                {
                    question: "Look! It _____ outside.",
                    options: ["snows", "is snowing", "has snowed", "snowed"],
                    answer: 1,
                    explanation: "The correct answer is 'is snowing' because it's an action happening now (present continuous)."
                },
                {
                    question: "I _____ many countries by the time I was 25.",
                    options: ["visited", "had visited", "have visited", "was visiting"],
                    answer: 1,
                    explanation: "The correct answer is 'had visited' because it's the past perfect for an action completed before a specific time in the past."
                }
            ],
            prepositions: [
                {
                    question: "I'm really good _____ playing chess.",
                    options: ["at", "in", "on", "with"],
                    answer: 0,
                    explanation: "The correct answer is 'at' because we use 'good at' for skills."
                },
                {
                    question: "She's been working here _____ 2015.",
                    options: ["for", "since", "from", "during"],
                    answer: 1,
                    explanation: "The correct answer is 'since' because we use it with a specific point in time."
                },
                {
                    question: "We arrived _____ the airport just in time.",
                    options: ["at", "in", "on", "to"],
                    answer: 0,
                    explanation: "The correct answer is 'at' because we use 'at' for specific locations."
                },
                {
                    question: "He's allergic _____ cats.",
                    options: ["with", "to", "for", "at"],
                    answer: 1,
                    explanation: "The correct answer is 'to' because we use 'allergic to' for substances causing allergies."
                },
                {
                    question: "The book is _____ the table.",
                    options: ["in", "on", "at", "over"],
                    answer: 1,
                    explanation: "The correct answer is 'on' because it indicates physical contact with a surface."
                },
                {
                    question: "I'm interested _____ learning Spanish.",
                    options: ["in", "on", "at", "for"],
                    answer: 0,
                    explanation: "The correct answer is 'in' because we use 'interested in' for subjects or activities."
                },
                {
                    question: "She apologized _____ being late.",
                    options: ["for", "about", "to", "with"],
                    answer: 0,
                    explanation: "The correct answer is 'for' because we use 'apologize for' something."
                },
                {
                    question: "The solution _____ the problem was quite simple.",
                    options: ["of", "to", "for", "with"],
                    answer: 1,
                    explanation: "The correct answer is 'to' because we use 'solution to' a problem."
                },
                {
                    question: "We're leaving _____ London tomorrow morning.",
                    options: ["to", "for", "into", "at"],
                    answer: 1,
                    explanation: "The correct answer is 'for' because we use 'leave for' a destination."
                },
                {
                    question: "The students were excited _____ the upcoming trip.",
                    options: ["about", "for", "with", "to"],
                    answer: 0,
                    explanation: "The correct answer is 'about' because we use 'excited about' something."
                }
            ],
            articles: [
                {
                    question: "She wants to be _____ astronaut when she grows up.",
                    options: ["a", "an", "the", ""],
                    answer: 1,
                    explanation: "The correct answer is 'an' because 'astronaut' starts with a vowel sound."
                },
                {
                    question: "_____ sun rises in the east.",
                    options: ["A", "An", "The", ""],
                    answer: 2,
                    explanation: "The correct answer is 'The' because we use 'the' with unique things like the sun."
                },
                {
                    question: "I need _____ information about this topic.",
                    options: ["a", "an", "the", ""],
                    answer: 3,
                    explanation: "The correct answer is no article because 'information' is uncountable."
                },
                {
                    question: "He plays _____ guitar very well.",
                    options: ["a", "an", "the", ""],
                    answer: 2,
                    explanation: "The correct answer is 'the' because we use 'the' with musical instruments."
                },
                {
                    question: "She has _____ university degree in biology.",
                    options: ["a", "an", "the", ""],
                    answer: 0,
                    explanation: "The correct answer is 'a' because 'university' starts with a consonant sound (yoo-niversity)."
                },
                {
                    question: "I saw _____ interesting movie last night.",
                    options: ["a", "an", "the", ""],
                    answer: 1,
                    explanation: "The correct answer is 'an' because 'interesting' starts with a vowel sound."
                },
                {
                    question: "_____ Himalayas are the highest mountains in the world.",
                    options: ["A", "An", "The", ""],
                    answer: 2,
                    explanation: "The correct answer is 'The' because we use 'the' with mountain ranges."
                },
                {
                    question: "She's _____ best student in the class.",
                    options: ["a", "an", "the", ""],
                    answer: 2,
                    explanation: "The correct answer is 'the' because of the superlative 'best'."
                },
                {
                    question: "Let's go for _____ walk in the park.",
                    options: ["a", "an", "the", ""],
                    answer: 0,
                    explanation: "The correct answer is 'a' because we're not referring to a specific walk."
                },
                {
                    question: "He's _____ honest man.",
                    options: ["a", "an", "the", ""],
                    answer: 1,
                    explanation: "The correct answer is 'an' because 'honest' starts with a silent H (vowel sound)."
                }
            ],
            conjunctions: [
                {
                    question: "I like both tea _____ coffee.",
                    options: ["and", "but", "or", "nor"],
                    answer: 0,
                    explanation: "The correct answer is 'and' because it connects two similar ideas."
                },
                {
                    question: "We can go to the movies _____ stay at home.",
                    options: ["and", "but", "or", "yet"],
                    answer: 2,
                    explanation: "The correct answer is 'or' because it presents alternatives."
                },
                {
                    question: "He worked hard, _____ he didn't pass the exam.",
                    options: ["and", "but", "so", "for"],
                    answer: 1,
                    explanation: "The correct answer is 'but' because it shows contrast."
                },
                {
                    question: "She was tired, _____ she continued working.",
                    options: ["and", "but", "or", "yet"],
                    answer: 3,
                    explanation: "The correct answer is 'yet' because it shows unexpected contrast."
                },
                {
                    question: "_____ it was raining, we decided to go out.",
                    options: ["Although", "Because", "So", "And"],
                    answer: 0,
                    explanation: "The correct answer is 'Although' because it introduces a concession."
                },
                {
                    question: "I'll text you _____ I arrive.",
                    options: ["until", "while", "when", "before"],
                    answer: 2,
                    explanation: "The correct answer is 'when' because it indicates the time of the action."
                },
                {
                    question: "She didn't study, _____ she failed the test.",
                    options: ["so", "but", "and", "nor"],
                    answer: 0,
                    explanation: "The correct answer is 'so' because it shows consequence."
                },
                {
                    question: "You can _____ stay _____ leave.",
                    options: ["either / or", "neither / nor", "both / and", "not only / but also"],
                    answer: 0,
                    explanation: "The correct answer is 'either / or' because it presents a choice between alternatives."
                },
                {
                    question: "_____ you hurry up, we'll be late.",
                    options: ["Unless", "If", "Because", "So"],
                    answer: 0,
                    explanation: "The correct answer is 'Unless' because it means 'if not'."
                },
                {
                    question: "She was late _____ her car broke down.",
                    options: ["because", "so", "but", "and"],
                    answer: 0,
                    explanation: "The correct answer is 'because' because it gives the reason."
                }
            ],
            modals: [
                {
                    question: "You _____ drink more water to stay hydrated.",
                    options: ["should", "must", "could", "would"],
                    answer: 0,
                    explanation: "The correct answer is 'should' because it gives advice."
                },
                {
                    question: "_____ I borrow your pen, please?",
                    options: ["Should", "Must", "Would", "May"],
                    answer: 3,
                    explanation: "The correct answer is 'May' because it politely asks for permission."
                },
                {
                    question: "You _____ smoke in the restaurant.",
                    options: ["mustn't", "don't have to", "shouldn't", "can't"],
                    answer: 0,
                    explanation: "The correct answer is 'mustn't' because it's a prohibition."
                },
                {
                    question: "She _____ speak four languages fluently.",
                    options: ["should", "must", "can", "has to"],
                    answer: 2,
                    explanation: "The correct answer is 'can' because it shows ability."
                },
                {
                    question: "I _____ swim when I was five years old.",
                    options: ["can", "could", "should", "would"],
                    answer: 1,
                    explanation: "The correct answer is 'could' because it shows past ability."
                },
                {
                    question: "You _____ to wear a seatbelt when driving.",
                    options: ["must", "have", "should", "need"],
                    answer: 1,
                    explanation: "The correct answer is 'have' because 'have to' shows obligation."
                },
                {
                    question: "_____ you pass the salt, please?",
                    options: ["Can", "Must", "Should", "Would"],
                    answer: 0,
                    explanation: "The correct answer is 'Can' because it's an informal request."
                },
                {
                    question: "It _____ rain later, so take an umbrella.",
                    options: ["can", "may", "should", "would"],
                    answer: 1,
                    explanation: "The correct answer is 'may' because it shows possibility."
                },
                {
                    question: "We _____ hurry if we don't want to miss the train.",
                    options: ["can", "must", "need", "should"],
                    answer: 2,
                    explanation: "The correct answer is 'must' because it shows necessity."
                },
                {
                    question: "He _____ be at home. I just saw him at the office.",
                    options: ["mustn't", "can't", "shouldn't", "wouldn't"],
                    answer: 1,
                    explanation: "The correct answer is 'can't' because it shows impossibility based on evidence."
                }
            ],
            conditionals: [
                {
                    question: "If it rains, we _____ cancel the picnic.",
                    options: ["will", "would", "would have", "had"],
                    answer: 0,
                    explanation: "The correct answer is 'will' because it's a first conditional (real possibility)."
                },
                {
                    question: "I _____ happy if I won the lottery.",
                    options: ["will be", "would be", "would have been", "am"],
                    answer: 1,
                    explanation: "The correct answer is 'would be' because it's a second conditional (unreal present)."
                },
                {
                    question: "If you _____ harder, you would have passed the exam.",
                    options: ["study", "studied", "had studied", "would study"],
                    answer: 2,
                    explanation: "The correct answer is 'had studied' because it's a third conditional (unreal past)."
                },
                {
                    question: "Unless you _____ soon, we'll leave without you.",
                    options: ["arrive", "arrived", "will arrive", "would arrive"],
                    answer: 0,
                    explanation: "The correct answer is 'arrive' because 'Unless' means 'if not' in a first conditional."
                },
                {
                    question: "I _____ called you if I'd had your number.",
                    options: ["will", "would", "had", "would have"],
                    answer: 3,
                    explanation: "The correct answer is 'would have' because it's a third conditional (unreal past)."
                },
                {
                    question: "If I were you, I _____ that job.",
                    options: ["take", "will take", "would take", "would have taken"],
                    answer: 2,
                    explanation: "The correct answer is 'would take' because it's a second conditional (giving advice)."
                },
                {
                    question: "She'll be upset if you _____ her the truth.",
                    options: ["don't tell", "won't tell", "didn't tell", "wouldn't tell"],
                    answer: 0,
                    explanation: "The correct answer is 'don't tell' because it's a first conditional (real possibility)."
                },
                {
                    question: "I _____ the earlier train if I'd woken up on time.",
                    options: ["catch", "would catch", "caught", "would have caught"],
                    answer: 3,
                    explanation: "The correct answer is 'would have caught' because it's a third conditional (unreal past)."
                },
                {
                    question: "If you heat ice, it _____.",
                    options: ["melts", "will melt", "would melt", "would have melted"],
                    answer: 0,
                    explanation: "The correct answer is 'melts' because it's a zero conditional (general truth)."
                },
                {
                    question: "_____ you help me if I needed you?",
                    options: ["Will", "Would", "Can", "Shall"],
                    answer: 1,
                    explanation: "The correct answer is 'Would' because it's a second conditional (hypothetical question)."
                }
            ]
        };

        // Game State
        let gameState = {
            currentCategory: '',
            difficulty: '',
            currentQuestionIndex: 0,
            score: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            selectedQuestions: [],
            answeredQuestions: [],
            categoryStats: {
                tenses: { correct: 0, total: 0 },
                prepositions: { correct: 0, total: 0 },
                articles: { correct: 0, total: 0 },
                conjunctions: { correct: 0, total: 0 },
                modals: { correct: 0, total: 0 },
                conditionals: { correct: 0, total: 0 }
            },
            musicPlaying: false
        };

        // DOM Elements
        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultsScreen = document.getElementById('results-screen');
        const questionElement = document.getElementById('question');
        const optionsContainer = document.getElementById('options-container');
        const nextButton = document.getElementById('next-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const scoreElement = document.getElementById('score');
        const questionCountElement = document.getElementById('question-count');
        const categoryTag = document.getElementById('category-tag');
        const difficultyTag = document.getElementById('difficulty-tag');
        const finalScoreElement = document.getElementById('final-score');
        const correctAnswersElement = document.getElementById('correct-answers');
        const wrongAnswersElement = document.getElementById('wrong-answers');
        const finalProgress = document.getElementById('final-progress');
        const categoryStatsElement = document.getElementById('category-stats');
        const restartButton = document.getElementById('restart-btn');
        const newCategoryButton = document.getElementById('new-category-btn');
        const musicToggle = document.getElementById('music-toggle');
        const backgroundMusic = document.getElementById('background-music');
        const correctSound = document.getElementById('correct-sound');
        const wrongSound = document.getElementById('wrong-sound');
        const resultIcon = document.getElementById('result-icon');
        const resultTitle = document.getElementById('result-title');
        const resultSubtitle = document.getElementById('result-subtitle');
        const resultStats = document.getElementById('result-stats');

        // Event Listeners
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                gameState.difficulty = btn.dataset.level;
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('ring-2', 'ring-offset-2'));
                btn.classList.add('ring-2', 'ring-offset-2');
                
                // Add specific ring colors based on difficulty
                if (gameState.difficulty === 'easy') {
                    btn.classList.add('ring-green-500');
                } else if (gameState.difficulty === 'medium') {
                    btn.classList.add('ring-yellow-500');
                } else {
                    btn.classList.add('ring-red-500');
                }
            });
        });

        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                gameState.currentCategory = btn.dataset.category;
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('ring-2', 'ring-offset-2'));
                btn.classList.add('ring-2', 'ring-offset-2');
                
                // Add specific ring colors based on category
                if (gameState.currentCategory === 'tenses') {
                    btn.classList.add('ring-blue-500');
                } else if (gameState.currentCategory === 'prepositions') {
                    btn.classList.add('ring-purple-500');
                } else if (gameState.currentCategory === 'articles') {
                    btn.classList.add('ring-pink-500');
                } else if (gameState.currentCategory === 'conjunctions') {
                    btn.classList.add('ring-indigo-500');
                } else if (gameState.currentCategory === 'modals') {
                    btn.classList.add('ring-green-500');
                } else if (gameState.currentCategory === 'conditionals') {
                    btn.classList.add('ring-yellow-500');
                } else {
                    btn.classList.add('ring-red-500');
                }
            });
        });

        document.getElementById('start-btn').addEventListener('click', startGame);
        nextButton.addEventListener('click', nextQuestion);
        restartButton.addEventListener('click', resetGame);
        newCategoryButton.addEventListener('click', () => {
            resetGame();
            startScreen.classList.remove('hidden');
            questionScreen.classList.add('hidden');
            resultsScreen.classList.add('hidden');
        });

        // Music control
        musicToggle.addEventListener('click', toggleMusic);

        function toggleMusic() {
            if (gameState.musicPlaying) {
                backgroundMusic.pause();
                musicToggle.innerHTML = '<i class="fas fa-music"></i>';
            } else {
                backgroundMusic.play();
                musicToggle.innerHTML = '<i class="fas fa-pause"></i>';
            }
            gameState.musicPlaying = !gameState.musicPlaying;
        }

        // Game Functions
        function startGame() {
            if (!gameState.currentCategory || !gameState.difficulty) {
                alert('Please select both difficulty and category!');
                return;
            }

            // Reset game state
            gameState.currentQuestionIndex = 0;
            gameState.score = 0;
            gameState.correctAnswers = 0;
            gameState.wrongAnswers = 0;
            gameState.answeredQuestions = [];
            
            // Select questions based on category
            if (gameState.currentCategory === 'all') {
                // Mix questions from all categories
                gameState.selectedQuestions = [
                    ...questions.tenses,
                    ...questions.prepositions,
                    ...questions.articles,
                    ...questions.conjunctions,
                    ...questions.modals,
                    ...questions.conditionals
                ];
            } else {
                gameState.selectedQuestions = [...questions[gameState.currentCategory]];
            }
            
            // Shuffle questions
            gameState.selectedQuestions = shuffleArray(gameState.selectedQuestions);
            
            // Adjust number of questions based on difficulty
            if (gameState.difficulty === 'easy') {
                gameState.selectedQuestions = gameState.selectedQuestions.slice(0, 5);
            } else if (gameState.difficulty === 'medium') {
                gameState.selectedQuestions = gameState.selectedQuestions.slice(0, 10);
            } else {
                gameState.selectedQuestions = gameState.selectedQuestions.slice(0, 15);
            }
            
            // Update UI
            startScreen.classList.add('hidden');
            questionScreen.classList.remove('hidden');
            
            // Set category and difficulty tags
            categoryTag.textContent = gameState.currentCategory === 'all' ? 'Mixed' : gameState.currentCategory;
            categoryTag.className = 'px-3 py-1 rounded-full text-xs font-semibold ' + 
                (gameState.currentCategory === 'tenses' ? 'bg-blue-100 text-blue-800' :
                 gameState.currentCategory === 'prepositions' ? 'bg-purple-100 text-purple-800' :
                 gameState.currentCategory === 'articles' ? 'bg-pink-100 text-pink-800' :
                 gameState.currentCategory === 'conjunctions' ? 'bg-indigo-100 text-indigo-800' :
                 gameState.currentCategory === 'modals' ? 'bg-green-100 text-green-800' :
                 gameState.currentCategory === 'conditionals' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800');
            
            difficultyTag.textContent = gameState.difficulty;
            difficultyTag.className = 'px-3 py-1 rounded-full text-xs font-semibold ' + 
                (gameState.difficulty === 'easy' ? 'bg-green-100 text-green-800' :
                 gameState.difficulty === 'medium' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800');
            
            // Show first question
            showQuestion();
        }

        function showQuestion() {
            const currentQuestion = gameState.selectedQuestions[gameState.currentQuestionIndex];
            
            // Update question text
            questionElement.textContent = currentQuestion.question;
            
            // Clear previous options
            optionsContainer.innerHTML = '';
            
            // Create option buttons
            currentQuestion.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = 'option-card w-full p-4 bg-gray-50 hover:bg-gray-100 rounded-lg text-left transition';
                optionButton.textContent = option;
                optionButton.dataset.index = index;
                optionButton.addEventListener('click', selectAnswer);
                optionsContainer.appendChild(optionButton);
            });
            
            // Update progress
            const progress = ((gameState.currentQuestionIndex) / gameState.selectedQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;
            progressText.textContent = Math.round(progress);
            
            // Update score
            scoreElement.textContent = gameState.score;
            
            // Update question count
            questionCountElement.textContent = `Question ${gameState.currentQuestionIndex + 1} of ${gameState.selectedQuestions.length}`;
            
            // Hide next button
            nextButton.classList.add('hidden');
        }

        function selectAnswer(e) {
            const selectedOptionIndex = parseInt(e.target.dataset.index);
            const currentQuestion = gameState.selectedQuestions[gameState.currentQuestionIndex];
            const optionButtons = document.querySelectorAll('.option-card');
            
            // Disable all options
            optionButtons.forEach(button => {
                button.removeEventListener('click', selectAnswer);
                button.classList.add('cursor-not-allowed');
            });
            
            // Mark correct and wrong answers
            optionButtons[currentQuestion.answer].classList.add('correct-answer');
            if (selectedOptionIndex !== currentQuestion.answer) {
                optionButtons[selectedOptionIndex].classList.add('wrong-answer');
            }
            
            // Update game state
            const isCorrect = selectedOptionIndex === currentQuestion.answer;
            if (isCorrect) {
                gameState.score += gameState.difficulty === 'easy' ? 10 : 
                                  gameState.difficulty === 'medium' ? 20 : 30;
                gameState.correctAnswers++;
                
                // Play correct sound
                correctSound.currentTime = 0;
                correctSound.play();
                
                // Create floating emoji for correct answer
                createFloatingEmoji(e.target, 'ðŸŽ‰');
            } else {
                gameState.wrongAnswers++;
                
                // Play wrong sound
                wrongSound.currentTime = 0;
                wrongSound.play();
                
                // Create floating emoji for wrong answer
                createFloatingEmoji(e.target, 'âŒ');
            }
            
            // Update category stats
            if (gameState.currentCategory !== 'all') {
                gameState.categoryStats[gameState.currentCategory].total++;
                if (isCorrect) {
                    gameState.categoryStats[gameState.currentCategory].correct++;
                }
            } else {
                // For mixed category, we need to determine which category the question belongs to
                let questionCategory = '';
                if (questions.tenses.some(q => q.question === currentQuestion.question)) {
                    questionCategory = 'tenses';
                } else if (questions.prepositions.some(q => q.question === currentQuestion.question)) {
                    questionCategory = 'prepositions';
                } else if (questions.articles.some(q => q.question === currentQuestion.question)) {
                    questionCategory = 'articles';
                } else if (questions.conjunctions.some(q => q.question === currentQuestion.question)) {
                    questionCategory = 'conjunctions';
                } else if (questions.modals.some(q => q.question === currentQuestion.question)) {
                    questionCategory = 'modals';
                } else {
                    questionCategory = 'conditionals';
                }
                
                gameState.categoryStats[questionCategory].total++;
                if (isCorrect) {
                    gameState.categoryStats[questionCategory].correct++;
                }
            }
            
            // Update score display
            scoreElement.textContent = gameState.score;
            
            // Show next button
            nextButton.classList.remove('hidden');
            
            // Store answered question
            gameState.answeredQuestions.push({
                question: currentQuestion.question,
                selectedOption: currentQuestion.options[selectedOptionIndex],
                correctOption: currentQuestion.options[currentQuestion.answer],
                isCorrect,
                explanation: currentQuestion.explanation
            });
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            
            if (gameState.currentQuestionIndex < gameState.selectedQuestions.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            questionScreen.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            // Update result display based on performance
            const percentageCorrect = (gameState.correctAnswers / gameState.selectedQuestions.length) * 100;
            
            if (percentageCorrect >= 80) {
                resultIcon.className = 'fas fa-trophy text-6xl mb-4 text-yellow-500';
                resultTitle.textContent = 'Excellent Work!';
                resultSubtitle.textContent = 'You\'re a grammar superstar!';
                resultStats.className = 'bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-6 mb-8 border border-green-200';
            } else if (percentageCorrect >= 50) {
                resultIcon.className = 'fas fa-award text-6xl mb-4 text-blue-500';
                resultTitle.textContent = 'Good Job!';
                resultSubtitle.textContent = 'You\'ve got solid grammar skills!';
                resultStats.className = 'bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl p-6 mb-8 border border-blue-200';
            } else {
                resultIcon.className = 'fas fa-lightbulb text-6xl mb-4 text-indigo-500';
                resultTitle.textContent = 'Keep Practicing!';
                resultSubtitle.textContent = 'Review the grammar rules and try again!';
                resultStats.className = 'bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 mb-8 border border-purple-200';
            }
            
            // Update final score
            finalScoreElement.textContent = gameState.score;
            correctAnswersElement.textContent = gameState.correctAnswers;
            wrongAnswersElement.textContent = gameState.wrongAnswers;
            
            // Update progress bar
            finalProgress.style.width = `${percentageCorrect}%`;
            
            // Show category stats
            categoryStatsElement.innerHTML = '';
            
            for (const [category, stats] of Object.entries(gameState.categoryStats)) {
                if (stats.total > 0) {
                    const percentage = Math.round((stats.correct / stats.total) * 100);
                    
                    const statElement = document.createElement('div');
                    statElement.className = 'bg-white p-4 rounded-lg shadow';
                    
                    const categoryName = document.createElement('div');
                    categoryName.className = 'font-semibold text-gray-700 mb-2 capitalize';
                    categoryName.textContent = category;
                    
                    const progressContainer = document.createElement('div');
                    progressContainer.className = 'w-full bg-gray-200 rounded-full h-2.5 mb-1';
                    
                    const progressBar = document.createElement('div');
                    progressBar.className = 'bg-indigo-600 h-2.5 rounded-full';
                    progressBar.style.width = `${percentage}%`;
                    
                    const statsText = document.createElement('div');
                    statsText.className = 'text-sm text-gray-500';
                    statsText.textContent = `${stats.correct} of ${stats.total} correct (${percentage}%)`;
                    
                    progressContainer.appendChild(progressBar);
                    statElement.appendChild(categoryName);
                    statElement.appendChild(progressContainer);
                    statElement.appendChild(statsText);
                    
                    categoryStatsElement.appendChild(statElement);
                }
            }
        }

        function resetGame() {
            gameState.currentQuestionIndex = 0;
            gameState.score = 0;
            gameState.correctAnswers = 0;
            gameState.wrongAnswers = 0;
            gameState.answeredQuestions = [];
            
            // Reset category stats
            for (const category in gameState.categoryStats) {
                gameState.categoryStats[category].correct = 0;
                gameState.categoryStats[category].total = 0;
            }
            
            // Reset progress bar
            progressBar.style.width = '0%';
            progressText.textContent = '0';
            scoreElement.textContent = '0';
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createFloatingEmoji(element, emoji) {
            const rect = element.getBoundingClientRect();
            const x = rect.left + rect.width / 2;
            const y = rect.top;
            
            const floatingEmoji = document.createElement('div');
            floatingEmoji.className = 'floating-emoji text-2xl';
            floatingEmoji.textContent = emoji;
            floatingEmoji.style.left = `${x}px`;
            floatingEmoji.style.top = `${y}px`;
            
            document.body.appendChild(floatingEmoji);
            
            // Remove after animation
            setTimeout(() => {
                floatingEmoji.remove();
            }, 2000);
        }
    </script>
</body>
</html>
